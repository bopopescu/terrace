{% extends "include/base.html" %}
{% block title %}
    <title>BINLOG ROLLBACK</title>
{% endblock %}
{% block name %}
    欢迎使用<span style="color:red">BINLOG解析/回滚SQL</span>功能
{% endblock %}
{%block content%}
    <div class="col-xs-10 col-md-12 main ">
        <form role="form" method='post'>
            {% csrf_token %}
            <div>
                <table >
                    </br>
                    </br>
                    CHOOSE :
                    <tr>
                        <td>
                            <select id='ins' class="form-control col-md-3" name="ins_set">
                                {% for obj in inslist%}
                                <option value = "{{ obj.id }}" >{{ obj.ip }} {{ obj.role }} {{ obj.db_type}}</option>
                                {% endfor %}
                            </select>
                        </td>
                    </tr>

                </table>
                </br>
                <button name="show_binary" class="btn btn-primary" value="1">show binary logs and DB</button >
                </br>

                {% if binlist %}
                    <table>
                        <tr>
                             <td>
                                CHOOSE BINLOG:</br>
                                <select  class="form-control col-md-3" name = "binary_list">
                                    {% for obj in binlist %}
                                      <option value ="{{ obj }}" {% if obj == binname %} selected {% endif %} >{{ obj }}</option>
                                    {% endfor %}
                                </select>
                                </br>
                            </td>

                            <td>
                                CHOOSE DB:</br>
                                <select  class="form-control col-md-3" name = "dblist">
                                    {% for obj in dblist %}
                                    <option value="{{ obj }}" {% if obj == dbselected %} selected {% endif %} >{{ obj }}</option>
                                    {% endfor %}
                                </select>
                            </td>

                            <td>
                                解析的表名:</br>
                                <input type=="text" placeholder="tablename" class="form-control" maxlength="30" value="{% if tbname %} {{ tbname }} {% endif %}" name="tbname">
                            </td>
                            <td>
                                CHOOSE BEGIN_TIME:</br>
                                {% if begintime %}
                                    <input type=="text" id="id_begin_time"  value="{{ begintime }}" class="form-control" maxlength="30" name="begin_time">
                                {% else %}
                                    <input type=="text" id="id_begin_time"  class="form-control" maxlength="30" name="begin_time">

                                {% endif %}
                            </td>
                            <td>
                                CHOOSE STOP_TIME:</br>
                                {% if begintime %}
                                    <input type=="text" id="id_begin_time"  value="{{ begintime }}" class="form-control" maxlength="30" name="begin_time">
                                {% else %}
                                    <input type=="text" id="id_begin_time"  class="form-control" maxlength="30" name="begin_time">

                                {% endif %}
                            </td>

                            <td>
                                CHOOSE 解析条数:</br>
                                <select class="form-control col-md-3" name = "countnum">

                                    {# 这里可以优化 #}
                                    {% if countnum == 10 %}
                                     <option value=10 selected="selected">10</option>
                                    {% else %}
                                     <option value=10>10</option>
                                    {% endif %}

                                    {% if countnum == 50 %}
                                     <option value=50 selected="selected">50</option>
                                    {% else %}
                                     <option value=50>50</option>
                                    {% endif %}

                                    {% if countnum == 200 %}
                                     <option value=200 selected="selected">200</option>
                                    {% else %}
                                     <option value=200>200</option>
                                    {% endif %}
                                </select>
                            </td>

                             <td>
                               解析SQL类型:</br>
                                <select  class="form-control col-md-3" name = "sql_type">

                                      <option value ="0" {% if sql_type == 0 %} selected {% endif %} >标准SQL</option>
                                      <option value ="1" {% if sql_type == 1 %} selected {% endif %} >回滚SQL</option>

                                </select>
                                </br>
                             </td>

                        </tr>
                    </table>
                {% endif %}

                {% if binlist %}
                    <button name="parse_commit"  class="btn btn-default" value="1">提交</button >
                {% endif %}
            </div>

        </form >
        <div>
            {% if info %}
                <span style="color:red">{{ info }}</span>
            {% endif %}
        </div>

         <table  class="table table-condensed" border="1">
            {% for i in sqllist %}
                <tr>
                    <td>
                        {{ forloop.counter }}
                    </td>
                    <td>
                        <pre>{{ i }}</pre>
                    </td>
                </tr>
            {% endfor %}
        </table>

    </div>

{% endblock %}

{% block script %}
    <script>
        jeDate({
            dateCell:"#id_begin_time",
            format:"YYYY-MM-DD hh:mm:ss",
            isinitVal:true,
            isTime:true, //isClear:false,
            minDate:"2014-09-19 00:00:00",
            okfun:function(val){alert(val)}
        })
    </script>
{% endblock %}