{% extends "include/base.html" %}
{% block title %}
    <title>showsql_info</title>
{% endblock %}
{% block name %}
    慢查询SQL明细
{% endblock %}
{%block content%}
    <div class="col-xs-10 col-md-12 main ">

         <form role="form" method='post'>
            {% csrf_token %}
            <div>
                <table >
                    <tr>

                        <td> 当前实例 : </td>
                        <td>
                            <input type="text" readonly class="form-control" value="{{ instance_res.ip }} {{ instance_res.port }}" />
                        </td>

                        <td> 选择数据库 : </td>
                        <td>
                            <select id='dbname' class="form-control col-md-3" name="dbname">
                                {% for obj in dblist %}
                                <option value = "{{ obj }}" {% if obj == db_name %} selected {% endif %} >{{ obj }}</option>
                                {% endfor %}
                            </select>
                        </td>

                          <td> 选择时间 : </td>
                        <td>
                            <input class="dateinput dateicon je-mr25 form-control col-md-6" id="ranges01" name="range-time" type="text"  value = "{{ start_time|date:'Y-m-d H:i:s' }} To {{ end_time|date:'Y-m-d H:i:s' }}" readonly>
                        </td>

                    </tr>

                </table>
                </br>
                    <button name="show_query" class="btn btn-primary" value="1">提交</button >
                </br>
            </div>

        <table class="table table-condensed" border="1" style="margin-top:10px">
            <thead>
            <tr >
                <th>执行开始时间</th>
                <th>数据库名</th>
                <th>用户名</th>
                <th>SQL语句</th>
                <th>执行总次数</th>
                <th>执行时长(95%)</th>
                <th>执行总时长(秒)</th>
                <th>锁定总时长(秒)</th>
                <th>解析总行数</th>
                <th>返回总行数</th>
            </tr>
            </thead>
            <tbody>
            {% if slow_sql_record_result %}
                {% for res in slow_sql_record_result %}
                <tr>
                    <td> {{ res.ExecutionStartTime|date:'Y-m-d H:i:s' }} </td>
                    <td> {{ res.DBName }} </td>
                    <td> {{ res.HostAddress }} </td>
                    <td> {{ res.SQLText}} </td>
                    <td> {{ res.TotalExecutionCounts }} </td>
                    <td> {{ res.QueryTimePct95|floatformat:2 }} </td>
                    <td> {{ res.QueryTimes|floatformat:2 }} </td>
                    <td> {{ res.LockTimes|floatformat:2 }} </td>
                    <td> {{ res.ParseRowCounts }} </td>
                    <td> {{ res.ReturnRowCounts }} </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr class="no-records-found">
                     <td colspan="10" style="vertical-align: middle !important;text-align: center;"> 没有匹配的记录...... </td>
                </tr>
            {% endif %}

            </tbody>
        </table>

    </form>

    </div>

{% endblock %}


{% block script %}

    <script>

        jeDate("#ranges01",{

            range:" To ",
            minDate:'2018-06-16 00:00:00',
            maxDate:'2099-06-16 00:00:00',
            format: 'YYYY-MM-DD hh:mm:ss'

        });

    </script>

{% endblock %}
